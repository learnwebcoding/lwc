angular.module('shoppingCartSpaApp',['ngMessages']).controller('shoppingCartSpaCtrl',function($scope,$filter){$scope.itemsDb=[{itemPriKey:1,itemName:"Intel Core i3-4130 Processor (3MB Cache, 3.40GHz) Haswell LGA1150 22nm Boxed",itemLaunchDate:"Q3'13",itemNumberOfCores:2,itemMaxTdp:"54W",itemProcessorGraphics:"Intel HD Graphics 4400",itemModelNumber:"BX80646I34130",itemImage:"i3-4130_19-116-946-TS_125x135.jpg",itemPriceEach:117.00},{itemPriKey:2,itemName:"Intel Core i3-4150 Processor (3MB Cache, 3.50GHz) Haswell LGA1150 22nm Boxed",itemLaunchDate:"Q2'14",itemNumberOfCores:2,itemMaxTdp:"54W",itemProcessorGraphics:"Intel HD Graphics 4400",itemModelNumber:"BX80646I34150",itemImage:"i3-4150_19-116-995-TS_125x135.jpg",itemPriceEach:117.00},{itemPriKey:3,itemName:"Intel Core i3-4160 Processor (3MB Cache, 3.60GHz) Haswell LGA1150 22nm Boxed",itemLaunchDate:"Q3'14",itemNumberOfCores:2,itemMaxTdp:"54W",itemProcessorGraphics:"Intel HD Graphics 4400",itemModelNumber:"BX80646I34160",itemImage:"i3-4160_19-117-447-01_125x135.jpg",itemPriceEach:117.00},{itemPriKey:4,itemName:"Intel Core i3-4170 Processor (3MB Cache, 3.70GHz) Haswell LGA1150 22nm Boxed",itemLaunchDate:"Q1'15",itemNumberOfCores:2,itemMaxTdp:"54W",itemProcessorGraphics:"Intel HD Graphics 4400",itemModelNumber:"BX80646I34170",itemImage:"i3-4170_19-117-543-02_125x135.jpg",itemPriceEach:117.00},{itemPriKey:5,itemName:"Intel Core i3-4330 Processor (4MB Cache, 3.50GHz) Haswell LGA1150 22nm Boxed",itemLaunchDate:"Q3'13",itemNumberOfCores:2,itemMaxTdp:"54W",itemProcessorGraphics:"Intel HD Graphics 4600",itemModelNumber:"BX80646I34330",itemImage:"i3-4330_19-116-945-TS_125x135.jpg",itemPriceEach:147.00},{itemPriKey:6,itemName:"Intel Core i3-4340 Processor (4MB Cache, 3.60GHz) Haswell LGA1150 22nm Boxed",itemLaunchDate:"Q3'13",itemNumberOfCores:2,itemMaxTdp:"54W",itemProcessorGraphics:"Intel HD Graphics 4600",itemModelNumber:"BX80646I34340",itemImage:"i3-4340_19-116-944-TS_125x135.jpg",itemPriceEach:157.00},{itemPriKey:7,itemName:"Intel Core i3-4350 Processor (4MB Cache, 3.60GHz) Haswell LGA1150 22nm Boxed",itemLaunchDate:"Q2'14",itemNumberOfCores:2,itemMaxTdp:"54W",itemProcessorGraphics:"Intel HD Graphics 4600",itemModelNumber:"BX80646I34350",itemImage:"i3-4350_19-116-994-TS_125x135.jpg",itemPriceEach:147.00},{itemPriKey:8,itemName:"Intel Core i3-4360 Processor (4MB Cache, 3.70GHz) Haswell LGA1150 22nm Boxed",itemLaunchDate:"Q2'14",itemNumberOfCores:2,itemMaxTdp:"54W",itemProcessorGraphics:"Intel HD Graphics 4600",itemModelNumber:"BX80646I34360",itemImage:"i3-4360_19-116-993-TS_125x135.jpg",itemPriceEach:147.00},{itemPriKey:9,itemName:"Intel Core i3-4370 Processor (4MB Cache, 3.80GHz) Haswell LGA1150 22nm Boxed",itemLaunchDate:"Q3'14",itemNumberOfCores:2,itemMaxTdp:"54W",itemProcessorGraphics:"Intel HD Graphics 4600",itemModelNumber:"BX80646I34370",itemImage:"i3-4370_19-117-446-TS_125x135.jpg",itemPriceEach:147.00}];$scope.deliveryMethodsDb=[{deliveryMethodPriKey:1,deliveryMethodName:"Free Super Saver (4 - 7 Business Days)",deliveryMethodPriceEach:0.00},{deliveryMethodPriKey:2,deliveryMethodName:"3 Business Days",deliveryMethodPriceEach:5.99},{deliveryMethodPriKey:3,deliveryMethodName:"2 Business Days",deliveryMethodPriceEach:19.99},{deliveryMethodPriKey:4,deliveryMethodName:"Next Business Day",deliveryMethodPriceEach:29.99}];$scope.regExpDb={allNameTypesAndCity:/[a-zA-Z]+/,address:/[a-zA-Z0-9]+/,address2Optional:/[a-zA-Z0-9]*/,quantity:/^[0-9]+$/,quantityOptional:/^[0-9 ]*$/,state:/^[a-zA-Z]{2}$/,zipCode:/^\d{5}$/,phoneNumber:/^\d{10}$|^\d{3}-\d{3}-\d{4}$/,creditCardNumber:/^\d{16}$|^\d{4} \d{4} \d{4} \d{4}$/,hideCreditCardNumber:function(creditCardNumber){var creditCardNumberLength=creditCardNumber.length;switch(creditCardNumberLength){case 16:var creditCardNumberHidden=creditCardNumber.replace(/^\d{12}/,"************");break;case 19:var creditCardNumberHidden=creditCardNumber.replace(/^\d{4} \d{4} \d{4} /,"**** **** **** ");break;default:alert("There was a problem processing the request. Error report - File: angular_shopping_cart_spa.js. Module: shoppingCartSpaApp. Controller: shoppingCartSpaCtrl. Object: $scope.regExpDb. Method: hideCreditCardNumber. Line: 196. Issue: creditCardNumberLength not matched by switch cases.");}
return creditCardNumberHidden;},creditCardExpirationMonth:/^\d{2}$/,creditCardExpirationYear:/^\d{4}$/,creditCardSecurityCode:/^\d{3}$/,emailAddress:/^\S+@[a-zA-Z0-9]+\.[a-zA-Z0-9]+$/};$scope.monthsByTwoNumbersDb=["01","02","03","04","05","06","07","08","09","10","12"];$scope.creditCardExpirationYearsDb=["2018","2019","2020","2021","2022","2023","2024","2025","2026","2027","2028","2029","2030"];$scope.fiftyStatesByTwoLettersDb=["AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"];$scope.shoppingCartDb={itemNameArray:[],itemQuantityArrayTemp:[],itemQuantityArray:[],itemPriceEachArray:[],itemPriceLineArray:[],allItemsQuantity:0,allItemsPrice:0,deliveryMethod:"",deliveryMethodPriceEach:0,allItemsAndDeliveryMethodPrice:0,isShoppingCartFull:false,isLineItemsReportFormValid:true,isRemoveItemCheckboxCheckedArray:[],isDeliveryMethodFormValid:true};$scope.shippingDb={firstName:"",lastName:"",fullName:"",address:"",address2:"",city:"",state:"",zipCode:"",phoneNumber:"",emailAddress:"",emailAddressConfirm:"",isShippingFormValid:true};$scope.billingDb={creditCardholderNameTemp:"",creditCardholderName:"",creditCardNumber:"",creditCardNumberHidden:"",creditCardExpirationMonth:"",creditCardExpirationYear:"",creditCardSecurityCode:"",addressTemp:"",address:"",address2Temp:"",address2:"",cityTemp:"",city:"",stateTemp:"",state:"",zipCodeTemp:"",zipCode:"",phoneNumberTemp:"",phoneNumber:"",isCreditCardFormValid:true,isBillingAddressSameAsTheShippingAddressCheckboxChecked:true,isBillingAddressFormValid:true};$scope.orderObjectDb={allItemsQuantity:"",allItemsPrice:"",deliveryMethod:"",deliveryMethodPriceEach:"",allItemsAndDeliveryMethodPrice:"",items:[],shippingInformation:{fullName:"",address:"",address2:"",city:"",state:"",zipCode:"",phoneNumber:"",emailAddress:""},billingInformation:{creditCardholderName:"",creditCardNumber:"",creditCardExpirationMonth:"",creditCardExpirationYear:"",creditCardSecurityCode:"",address:"",address2:"",city:"",state:"",zipCode:"",phoneNumber:""}};$scope.orderObjectDbAsJsonString={};validateForm=function(database,form){var formCharZeroToUpperCase=form.charAt(0).toUpperCase();var formCharsOneThroughEnd=form.slice(1);var formName="is"+formCharZeroToUpperCase+formCharsOneThroughEnd+"Valid";if($scope[form].$valid){$scope[database][formName]=true;return true;}else if($scope[form].$invalid){alert("Please resolve the indicated item(s).");var firstInvalidFormElement=document[form].querySelector(".ng-invalid");firstInvalidFormElement.focus();firstInvalidFormElement.parentNode.scrollIntoView(true);$scope[database][formName]=false;return false;}else{alert("There was a problem processing the request. Error report - File: angularjs_shopping_cart_spa.js. Module: shoppingCartSpaApp. Controller: shoppingCartSpaCtrl. Method: validateForm(). Line: 445. Issue: $scope[form] object does not have .$valid or $.invalid property.");}};returnObjectIndexInArrayByPropertyAndValue=function(array,property,value){for(var i=0;i<array.length;i++){if(array[i][property]===value){return i;}}
return-1;};$scope.view="shopping";$scope.changeViewTo=function(view){shoppingCartSummaryBtn=document.getElementById("shoppingCartSummaryBtnId");shoppingCartSummaryBtn.scrollIntoView(true);$scope.view=view;};$scope.goToShoppingCart=function(){$scope.isShoppingCartFull();$scope.changeViewTo("shoppingCart");};$scope.updateShoppingCartSummary=function(){$scope.shoppingCartDb.allItemsQuantity=0;$scope.shoppingCartDb.allItemsPrice=0;var itemArrayLength=$scope.shoppingCartDb.itemNameArray.length;for(var i=0;i<itemArrayLength;i++){var itemQuantity=$scope.shoppingCartDb.itemQuantityArray[i];$scope.shoppingCartDb.allItemsQuantity+=itemQuantity;var itemPriceLine=$scope.shoppingCartDb.itemPriceLineArray[i];$scope.shoppingCartDb.allItemsPrice+=itemPriceLine;}
$scope.shoppingCartDb.allItemsAndDeliveryMethodPrice=$scope.shoppingCartDb.allItemsPrice+$scope.shoppingCartDb.deliveryMethodPriceEach;};$scope.isShoppingCartFull=function(){var itemArrayLength=$scope.shoppingCartDb.itemNameArray.length;if(itemArrayLength===0){$scope.shoppingCartDb.isShoppingCartFull=false;return false;}else{$scope.shoppingCartDb.itemQuantityArrayTemp=$scope.shoppingCartDb.itemQuantityArray.slice(0);$scope.shoppingCartDb.isShoppingCartFull=true;return true;}};$scope.addItemToCart=function(itemName){var itemObjectBackendDbIndex=returnObjectIndexInArrayByPropertyAndValue($scope.itemsDb,"itemName",itemName);var itemPriceEach=$scope.itemsDb[itemObjectBackendDbIndex].itemPriceEach;if($scope.shoppingCartDb.itemNameArray.indexOf(itemName)===-1){$scope.shoppingCartDb.itemNameArray.push(itemName);$scope.shoppingCartDb.itemQuantityArray.push(1);$scope.shoppingCartDb.itemPriceEachArray.push(itemPriceEach);$scope.shoppingCartDb.itemPriceLineArray.push(itemPriceEach);}else{var itemFrontendDbIndex=$scope.shoppingCartDb.itemNameArray.indexOf(itemName);var itemQuantity=$scope.shoppingCartDb.itemQuantityArray[itemFrontendDbIndex];itemQuantity+=1;var itemPriceLine=itemQuantity*itemPriceEach;$scope.shoppingCartDb.itemQuantityArray[itemFrontendDbIndex]=itemQuantity;$scope.shoppingCartDb.itemPriceLineArray[itemFrontendDbIndex]=itemPriceLine;}
$scope.shoppingCartDb.isLineItemsReportFormValid=true;$scope.updateShoppingCartSummary();$scope.isShoppingCartFull();$scope.changeViewTo("shoppingCart");};$scope.updateShoppingCartQuantities=function(){var isLineItemsReportFormValid=validateForm("shoppingCartDb","lineItemsReportForm");if(isLineItemsReportFormValid){var itemArrayLength=$scope.shoppingCartDb.itemNameArray.length;for(var i=0;i<itemArrayLength;i++){var isRemoveItemCheckboxChecked=$scope.shoppingCartDb.isRemoveItemCheckboxCheckedArray[i];var itemQuantityTempValue=$scope.shoppingCartDb.itemQuantityArrayTemp[i];itemQuantityTemp=Number(itemQuantityTempValue);var removeItemCheckbox=document.getElementById("removeItemCheckbox"+i+"Id");var itemName=removeItemCheckbox.name;var itemIndex=$scope.shoppingCartDb.itemNameArray.indexOf(itemName);if((isRemoveItemCheckboxChecked)||(itemQuantityTemp===0)){$scope.shoppingCartDb.itemNameArray.splice(itemIndex,1);$scope.shoppingCartDb.itemQuantityArray.splice(itemIndex,1);$scope.shoppingCartDb.itemPriceEachArray.splice(itemIndex,1);$scope.shoppingCartDb.itemPriceLineArray.splice(itemIndex,1);}else{var itemPriceEach=$scope.shoppingCartDb.itemPriceEachArray[itemIndex];var itemPriceLine=itemQuantityTemp*itemPriceEach;$scope.shoppingCartDb.itemQuantityArray[itemIndex]=itemQuantityTemp;$scope.shoppingCartDb.itemPriceLineArray[itemIndex]=itemPriceLine;}
$scope.shoppingCartDb.isRemoveItemCheckboxCheckedArray[i]=false;}
$scope.updateShoppingCartSummary();var isShoppingCartFull=$scope.isShoppingCartFull();if(isShoppingCartFull){return true;}else{return false;}}else{return false;}};$scope.addDeliveryMethod=function(){var deliveryMethodObjectBackendDbIndex=returnObjectIndexInArrayByPropertyAndValue($scope.deliveryMethodsDb,"deliveryMethodName",$scope.shoppingCartDb.deliveryMethod);$scope.shoppingCartDb.deliveryMethodPriceEach=$scope.deliveryMethodsDb[deliveryMethodObjectBackendDbIndex].deliveryMethodPriceEach;$scope.updateShoppingCartSummary();};$scope.processShoppingCart_checkout=function(){var isLineItemsReportFormValidAndShoppingCartFull=$scope.updateShoppingCartQuantities();if(isLineItemsReportFormValidAndShoppingCartFull){var isDeliveryMethodFormValid=validateForm("shoppingCartDb","deliveryMethodForm");if(isDeliveryMethodFormValid){$scope.changeViewTo("shipping");}else{deliveryMethodFormHeading=document.getElementById("deliveryMethodFormHeadingId");deliveryMethodFormHeading.scrollIntoView(true);}}};$scope.processShipping_goToBilling=function(){var isShippingFormValid=validateForm("shippingDb","shippingForm");if(isShippingFormValid){$scope.shippingDb.fullName=$scope.shippingDb.firstName+" "+$scope.shippingDb.lastName;if($scope.billingDb.creditCardholderName===""){$scope.billingDb.creditCardholderNameTemp=$scope.shippingDb.fullName;}else{$scope.billingDb.creditCardholderNameTemp=$scope.billingDb.creditCardholderName;}
$scope.changeViewTo("billing");}};$scope.insertBillingAddressFormValues=function(event){if($scope.billingDb.isBillingAddressSameAsTheShippingAddressCheckboxChecked===false){if($scope.billingDb.address===""){$scope.billingDb.addressTemp=$scope.shippingDb.address;$scope.billingDb.address2Temp=$scope.shippingDb.address2;$scope.billingDb.cityTemp=$scope.shippingDb.city;$scope.billingDb.stateTemp=$scope.shippingDb.state;$scope.billingDb.zipCodeTemp=$scope.shippingDb.zipCode;$scope.billingDb.phoneNumberTemp=$scope.shippingDb.phoneNumber;}else{$scope.billingDb.addressTemp=$scope.billingDb.address;$scope.billingDb.address2Temp=$scope.billingDb.address2;$scope.billingDb.cityTemp=$scope.billingDb.city;$scope.billingDb.stateTemp=$scope.billingDb.state;$scope.billingDb.zipCodeTemp=$scope.billingDb.zipCode;$scope.billingDb.phoneNumberTemp=$scope.billingDb.phoneNumber;}}};$scope.processBilling_goToReviewOrder=function(event){var isCreditCardFormValid=validateForm("billingDb","creditCardForm");if(isCreditCardFormValid){$scope.billingDb.creditCardholderName=$scope.billingDb.creditCardholderNameTemp;$scope.billingDb.creditCardNumberHidden=$scope.regExpDb.hideCreditCardNumber($scope.billingDb.creditCardNumber);if($scope.billingDb.isBillingAddressSameAsTheShippingAddressCheckboxChecked){$scope.billingDb.address=$scope.shippingDb.address;$scope.billingDb.address2=$scope.shippingDb.address2;$scope.billingDb.city=$scope.shippingDb.city;$scope.billingDb.state=$scope.shippingDb.state;$scope.billingDb.zipCode=$scope.shippingDb.zipCode;$scope.billingDb.phoneNumber=$scope.shippingDb.phoneNumber;$scope.changeViewTo("reviewOrder");}else{var isBillingAddressFormValid=validateForm("billingDb","billingAddressForm");if(isBillingAddressFormValid){$scope.billingDb.address=$scope.billingDb.addressTemp;$scope.billingDb.address2=$scope.billingDb.address2Temp;$scope.billingDb.city=$scope.billingDb.cityTemp;$scope.billingDb.state=$scope.billingDb.stateTemp;$scope.billingDb.zipCode=$scope.billingDb.zipCodeTemp;$scope.billingDb.phoneNumber=$scope.billingDb.phoneNumberTemp;$scope.changeViewTo("reviewOrder");}}}};$scope.placeFakeOrder=function(event){$scope.createOrderObject();$scope.changeViewTo("orderConfirmation");};$scope.createOrderObject=function(){$scope.orderObject={allItemsQuantity:$scope.shoppingCartDb.allItemsQuantity,allItemsPrice:$filter('currency')($scope.shoppingCartDb.allItemsPrice,"$"),deliveryMethod:$scope.shoppingCartDb.deliveryMethod,deliveryMethodPriceEach:$filter('currency')($scope.shoppingCartDb.deliveryMethodPriceEach,"$"),allItemsAndDeliveryMethodPrice:$filter('currency')($scope.shoppingCartDb.allItemsAndDeliveryMethodPrice,"$"),items:[],shippingInformation:{fullName:$scope.shippingDb.fullName,address:$scope.shippingDb.address,address2:$scope.shippingDb.address2,city:$scope.shippingDb.city,state:$scope.shippingDb.state,zipCode:$scope.shippingDb.zipCode,phoneNumber:$scope.shippingDb.phoneNumber,emailAddress:$scope.shippingDb.emailAddress},billingInformation:{creditCardholderName:$scope.billingDb.creditCardholderName,creditCardNumber:$scope.billingDb.creditCardNumber,creditCardExpirationMonth:$scope.billingDb.creditCardExpirationMonth,creditCardExpirationYear:$scope.billingDb.creditCardExpirationYear,creditCardSecurityCode:$scope.billingDb.creditCardSecurityCode,address:$scope.billingDb.address,address2:$scope.billingDb.address2,city:$scope.billingDb.city,state:$scope.billingDb.state,zipCode:$scope.billingDb.zipCode,phoneNumber:$scope.billingDb.phoneNumber}};var itemArrayLength=$scope.shoppingCartDb.itemNameArray.length;for(var i=0;i<itemArrayLength;i++){$scope.orderObject.items[i]={};$scope.orderObject.items[i].itemName=$scope.shoppingCartDb.itemNameArray[i];$scope.orderObject.items[i].itemQuantity=$scope.shoppingCartDb.itemQuantityArray[i];var itemPriceEach=$scope.shoppingCartDb.itemPriceEachArray[i];$scope.orderObject.items[i].itemPriceEach=$filter('currency')(itemPriceEach,"$");var itemPriceLine=$scope.shoppingCartDb.itemPriceLineArray[i];$scope.orderObject.items[i].itemPriceLine=$filter('currency')(itemPriceLine,"$");}
$scope.orderObjectAsJsonString=$filter('json')($scope.orderObject,1);};});